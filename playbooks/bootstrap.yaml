- name: Install packages
  hosts: all
  gather_facts: false
  vars:
    interpreter_pkgs:
      - python3
      - python3-apt
    bootstrap_packages: '{{ bootstrap__install_packages | d([]) }}'
  pre_tasks:
    - name: Install interpreter and required modules
      ansible.builtin.raw: |
        apt update -q=2
        env LC_ALL=C apt install -q=1 --no-install-recommends -y {{ pkgs }}
      vars:
        pkgs: '{{ interpreter_pkgs | join(" ") }}'
      register: apt
      changed_when: '"0 upgraded, 0 newly installed" not in apt.stdout'
  tasks:
    - name: Install packages needed for bootstrap
      ansible.builtin.apt:
        name: '{{ bootstrap_packages }}'
        state: present
